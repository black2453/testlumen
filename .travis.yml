# 以下為docker環境設置
sudo: required

services:
  - docker

env:
#  DOCKER_COMPOSE_VERSION: 1.23.2
  DOCKER_COMPOSE_VERSION: 1.27.0-rc1

before_install:
  - sudo apt-get -y update
  - sudo apt-get -y purge docker.io
  - sudo apt-get -y install docker.io
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin

before_script:
  - ls -lah
  - docker --version
  - cp .env.example .env
  - cp docker-compose.yml.example docker-compose.yml
  - docker-compose up -d --build
#  - composer install
# 以上為docker環境設置
#  - docker container ls
#  - 設定db環境(直接匯入資料庫)
  - sudo cp nuxt_shop.sql docker/mysql/nuxt_shop.sql
  - docker-compose ps
#  - docker-comopse exec shop-db show databases;
#  - docker exec -it testlumen_shop-db_1 bash
#  - mysql -u root -p
#  - root
#  - bash show databases;
#  - CREATE DATABASE  nuxt_shop
#  - show databases;
#  - mysql -u root -p nuxt_shop < nuxt_shop.sql
#  - exit
#  - exit
#  - docker exec -it testlumen_shop-web_1 bash
#  - cd /var/www
#  - composer install
#  - docker-compose exec shop-web bash
#  - cd /var/www

#jobs:
#  fast_finish: true
#  include:
#    -
#      script:
#        - composer install
#        - vendor/bin/phpunit

script:
#  docker exec -it testlumen_shop-db_1 bash
#  mysql -u root -p;
#  root;
#  show databases;
#  CREATE DATABASE  nuxt_shop;
#  show databases;
#  mysql -u root -p nuxt_shop < nuxt_shop.sql;
#  exit;
#  exit;
#  docker exec -it testlumen_shop-web_1 bash;
#  cd /var/www;
#  composer install;
#  vendor/bin/phpunit;
#  docker exec -it testlumen_shop-db_1 bash -c " mysql -uroot -proot CREATE DATABASE  nuxt_shop; "
#  docker exec -it testlumen_shop-db_1 bash -c " mysql -uroot -proot nuxt_shop < nuxt_shop.sql "
#  docker exec -i testlumen_shop-db_1  mysql -uroot -proot CREATE DATABASE  nuxt_shop;
#  docker exec -it testlumen_shop-db_1 bash -c " mysql -uroot -proot nuxt_shop < nuxt_shop.sql "
#  docker exec -i testlumen_shop-db_1  mysql -uroot -proot nuxt_shop < nuxt_shop.sql;
  docker exec -it testlumen_shop-db_1 bash -c "  mysql -u root -p;root;show databases;CREATE DATABASE  nuxt_shop;show databases;mysql -u root -p nuxt_shop < nuxt_shop.sql;exit;exit; "
  docker exec -it testlumen_shop-web_1 bash -c "
  cd /var/www && \
  composer install&& \
  vendor/bin/phpunit "

after_script:
  - docker-compose down

#    佈署相關資訊
#deploy:
#  provider: pages
#  skip-cleanup: true
#  github-token: $GITHUB_TOKEN
#  local-dir: public
#  repo: ms314006/ms314006.github.io
#  target_branch: master

